{"version":3,"file":"context-menu-actions.js","sources":["../../../src/context-menu-actions.ts"],"sourcesContent":["import AjaxRequest from '@typo3/core/ajax/ajax-request.js';\nimport Notification from '@typo3/backend/notification.js';\nimport Modal from '@typo3/backend/modal.js';\nimport { SeverityEnum } from '@typo3/backend/enum/severity.js';\n\ninterface UpdateResponse {\n    success: boolean;\n    updated: number;\n    skipped: number;\n    message?: string;\n    correlations?: {\n        correlationIdSlugUpdate: string;\n        correlationIdRedirectCreation: string;\n    };\n}\n\nfunction recursiveSlugUpdate(_table: string, uid: string): void {\n    Modal.confirm(\n        TYPO3.lang['contextMenu.recursiveSlugUpdate.confirm.title'] || 'Regenerate URL Paths',\n        TYPO3.lang['contextMenu.recursiveSlugUpdate.confirm.message'] || 'This will regenerate URL paths for all child pages based on their source fields. Continue?',\n        SeverityEnum.warning,\n        [\n            {\n                text: TYPO3.lang['contextMenu.recursiveSlugUpdate.button.cancel'] || 'Cancel',\n                active: true,\n                btnClass: 'btn-default',\n                trigger: (): void => {\n                    Modal.dismiss();\n                },\n            },\n            {\n                text: TYPO3.lang['contextMenu.recursiveSlugUpdate.confirm.title'] || 'Regenerate URL Paths',\n                btnClass: 'btn-warning',\n                trigger: (): void => {\n                    Modal.dismiss();\n                    void performUpdate(uid);\n                },\n            },\n        ],\n    );\n}\n\nasync function performUpdate(uid: string): Promise<void> {\n    try {\n        const response = await new AjaxRequest(TYPO3.settings.ajaxUrls.sluggi_recursive_slug_update)\n            .withQueryArguments({ id: uid })\n            .get();\n\n        const result = await response.resolve() as UpdateResponse;\n\n        if (result.success) {\n            const title = TYPO3.lang['contextMenu.recursiveSlugUpdate.confirm.title'] || 'URL Paths';\n\n            if (result.updated > 0) {\n                const parts: string[] = [];\n                parts.push(`${result.updated} updated`);\n                if (result.skipped > 0) {\n                    parts.push(`${result.skipped} skipped`);\n                }\n                Notification.success(title, parts.join(', ') + '.');\n\n                if (result.correlations) {\n                    document.dispatchEvent(new CustomEvent('typo3:redirects:slugChanged', {\n                        detail: {\n                            componentName: 'redirects',\n                            eventName: 'slugChanged',\n                            correlations: result.correlations,\n                            autoUpdateSlugs: true,\n                            autoCreateRedirects: false,\n                        },\n                    }));\n                }\n            } else {\n                Notification.info(title, 'No URL paths needed updating.');\n            }\n\n            document.dispatchEvent(new CustomEvent('typo3:pagetree:refresh'));\n        } else {\n            Notification.error('Error', result.message || 'Update failed.');\n        }\n    } catch {\n        Notification.error('Error', 'An unexpected error occurred.');\n    }\n}\n\nexport default { recursiveSlugUpdate };\n"],"names":["recursiveSlugUpdate","_table","uid","Modal","SeverityEnum","performUpdate","result","AjaxRequest","title","parts","Notification","contextMenuActions"],"mappings":"oMAgBA,SAASA,EAAoBC,EAAgBC,EAAmB,CAC5DC,EAAM,QACF,MAAM,KAAK,+CAA+C,GAAK,uBAC/D,MAAM,KAAK,iDAAiD,GAAK,6FACjEC,EAAa,QACb,CACI,CACI,KAAM,MAAM,KAAK,+CAA+C,GAAK,SACrE,OAAQ,GACR,SAAU,cACV,QAAS,IAAY,CACjBD,EAAM,QAAA,CACV,CAAA,EAEJ,CACI,KAAM,MAAM,KAAK,+CAA+C,GAAK,uBACrE,SAAU,cACV,QAAS,IAAY,CACjBA,EAAM,QAAA,EACDE,EAAcH,CAAG,CAC1B,CAAA,CACJ,CACJ,CAER,CAEA,eAAeG,EAAcH,EAA4B,CACrD,GAAI,CAKA,MAAMI,EAAS,MAJE,MAAM,IAAIC,EAAY,MAAM,SAAS,SAAS,4BAA4B,EACtF,mBAAmB,CAAE,GAAIL,CAAA,CAAK,EAC9B,IAAA,GAEyB,QAAA,EAE9B,GAAII,EAAO,QAAS,CAChB,MAAME,EAAQ,MAAM,KAAK,+CAA+C,GAAK,YAE7E,GAAIF,EAAO,QAAU,EAAG,CACpB,MAAMG,EAAkB,CAAA,EACxBA,EAAM,KAAK,GAAGH,EAAO,OAAO,UAAU,EAClCA,EAAO,QAAU,GACjBG,EAAM,KAAK,GAAGH,EAAO,OAAO,UAAU,EAE1CI,EAAa,QAAQF,EAAOC,EAAM,KAAK,IAAI,EAAI,GAAG,EAE9CH,EAAO,cACP,SAAS,cAAc,IAAI,YAAY,8BAA+B,CAClE,OAAQ,CACJ,cAAe,YACf,UAAW,cACX,aAAcA,EAAO,aACrB,gBAAiB,GACjB,oBAAqB,EAAA,CACzB,CACH,CAAC,CAEV,MACII,EAAa,KAAKF,EAAO,+BAA+B,EAG5D,SAAS,cAAc,IAAI,YAAY,wBAAwB,CAAC,CACpE,MACIE,EAAa,MAAM,QAASJ,EAAO,SAAW,gBAAgB,CAEtE,MAAQ,CACJI,EAAa,MAAM,QAAS,+BAA+B,CAC/D,CACJ,CAEA,MAAAC,EAAe,CAAE,oBAAAX,CAAA"}